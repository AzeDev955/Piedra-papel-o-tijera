<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Login Piedra Papel Tijera</title>
    <style>
      body {
        font-family: sans-serif;
        display: flex;
        justify-content: center;
        margin-top: 50px;
        background-color: #222;
        color: white;
      }
      form {
        background: #333;
        padding: 20px;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        width: 300px;
      }
      input {
        padding: 10px;
        border-radius: 4px;
        border: none;
      }
      button {
        padding: 10px;
        background: #007bff;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 4px;
        font-weight: bold;
      }
      button:hover {
        background: #0056b3;
      }
      #mensaje {
        margin-top: 10px;
        text-align: center;
        color: yellow;
      }
    </style>
  </head>
  <body>
    <form id="loginForm">
      <h2 style="text-align: center">ðŸŽ® Acceso</h2>

      <input
        type="text"
        id="identificador"
        placeholder="Email o Nickname"
        required
      />
      <input type="password" id="password" placeholder="ContraseÃ±a" required />

      <button type="submit">Entrar</button>
      <a href="registro.html">No tienes cuenta?</a>
      <div id="mensaje"></div>
    </form>

    <script>
      const form = document.getElementById("loginForm");
      const mensajeDiv = document.getElementById("mensaje");

      form.addEventListener("submit", async (e) => {
        e.preventDefault(); // Evita que la pÃ¡gina se recargue

        // 1. Recoger datos
        const identificador = document.getElementById("identificador").value;
        const password = document.getElementById("password").value;

        try {
          // 2. Enviar al Backend (Fetch)
          const respuesta = await fetch("http://localhost:8000/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ identificador, password }),
          });

          const datos = await respuesta.json();

          if (respuesta.ok) {
            // 3. Â¡Ã‰XITO! Guardamos el token
            sessionStorage.setItem("jwt_token", datos.token);
            sessionStorage.setItem("user_info", JSON.stringify(datos.usuario));

            mensajeDiv.style.color = "lightgreen";
            mensajeDiv.innerText = "Â¡Login Correcto! Token guardado.";

            // AquÃ­ redirigirÃ­amos al juego (lobby.html)
            console.log("Token:", datos.token);
            setTimeout(() => {
              alert("Â¡Vamos a jugar!");
            }, 500);
          } else {
            mensajeDiv.style.color = "red";
            mensajeDiv.innerText = datos.message || "Error al entrar";
          }
        } catch (error) {
          mensajeDiv.innerText = "Error de conexiÃ³n con el servidor";
        }
      });
    </script>
  </body>
</html>
